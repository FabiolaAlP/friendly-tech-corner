---
import Layout from "../layouts/Layout.astro";
import BlogList from "../components/BlogList.astro";
import { format } from "date-fns";
const title = "Blog";
const headers = { "Content-Type": "application/json" };
const GET_ALL_POSTS = `{
  posts(where: {orderby: {field: DATE, order: DESC}}) {
    nodes {
      slug
      title
      author {
        node {
          name
        }
      }
      date
      excerpt
      tags {
        edges {
          node {
            name
          }
        }
      }
      }
    }
  }`;
const getPosts = async () => {
  try {
    const res = await fetch(import.meta.env.WP_GRAPHQL, {
      method: "POST",
      headers,
      body: JSON.stringify({ query: GET_ALL_POSTS }),
    });
    const resData = await res.json();
    return resData?.data?.posts?.nodes ?? [];
  } catch (error) {
    console.error("Error fetching posts: ", error);
  }
};
const posts = await getPosts();
---

<Layout title={title}>
  <h2
    class="font-ibm font-bold text-2xl md:text-3xl text-light-primary dark:text-dark-primary text-center mt-20"
  >
    All Posts
  </h2>
  <BlogList posts={posts} />
</Layout>
